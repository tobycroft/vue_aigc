import{ag as Rt,o as de,X as pe,Y as fs,$ as us,H as E,z as Lt,a2 as rt,_ as ds,D as ps,ah as ms,v as _s,B as ys}from"./index-0QX2Zep0.js";const y={};function gs(s,e){return e.forEach(function(t){t&&typeof t!="string"&&!Array.isArray(t)&&Object.keys(t).forEach(function(r){if(r!=="default"&&!(r in s)){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(s,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}})}),Object.freeze(s)}var vs=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Es=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],Fe=function(e){var t=e,r=e.indexOf("["),n=e.indexOf("]");r!=-1&&n!=-1&&(e=e.substring(0,r)+e.substring(r,n).replace(/:/g,";")+e.substring(n,e.length));for(var i=vs.exec(e||""),o={},a=14;a--;)o[Es[a]]=i[a]||"";return r!=-1&&n!=-1&&(o.source=t,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=bs(o,o.path),o.queryKey=Ss(o,o.query),o};function bs(s,e){var t=/\/{2,9}/g,r=e.replace(t,"/").split("/");return(e.substr(0,1)=="/"||e.length===0)&&r.splice(0,1),e.substr(e.length-1,1)=="/"&&r.splice(r.length-1,1),r}function Ss(s,e){var t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,n,i){n&&(t[n]=i)}),t}function xs(s,e="",t){let r=s;t=t||typeof location<"u"&&location,s==null&&(s=t.protocol+"//"+t.host),typeof s=="string"&&(s.charAt(0)==="/"&&(s.charAt(1)==="/"?s=t.protocol+s:s=t.host+s),/^(https?|wss?):\/\//.test(s)||(typeof t<"u"?s=t.protocol+"//"+s:s="https://"+s),r=Fe(s)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const i=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+i+":"+r.port+e,r.href=r.protocol+"://"+i+(t&&t.port===r.port?"":":"+r.port),r}/**
 * Wrapper for built-in http.js to emulate the browser XMLHttpRequest object.
 *
 * This can be used with JS designed for browsers to improve reuse of code and
 * allow the use of existing libraries.
 *
 * Usage: include("XMLHttpRequest.js") and use XMLHttpRequest per W3C specs.
 *
 * @author Dan DeFelippi <dan@driverdan.com>
 * @contributor David Ellis <d.f.ellis@ieee.org>
 * @license MIT
 */var ws=y.spawn,Ee=$e;$e.XMLHttpRequest=$e;function $e(s){s=s||{};var e=this,t=y,r=y,n,i,o={},a=!1,h={"User-Agent":"node-XMLHttpRequest",Accept:"*/*"},c=Object.assign({},h),u=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","content-transfer-encoding","cookie","cookie2","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","via"],l=["TRACE","TRACK","CONNECT"],d=!1,g=!1,v=!1,b={};this.UNSENT=0,this.OPENED=1,this.HEADERS_RECEIVED=2,this.LOADING=3,this.DONE=4,this.readyState=this.UNSENT,this.onreadystatechange=null,this.responseText="",this.responseXML="",this.status=null,this.statusText=null;var X=function(f){return a||f&&u.indexOf(f.toLowerCase())===-1},se=function(f){return f&&l.indexOf(f)===-1};this.open=function(f,m,O,C,L){if(this.abort(),g=!1,v=!1,!se(f))throw new Error("SecurityError: Request method not allowed");o={method:f,url:m.toString(),async:typeof O!="boolean"?!0:O,user:C||null,password:L||null},k(this.OPENED)},this.setDisableHeaderCheck=function(f){a=f},this.setRequestHeader=function(f,m){if(this.readyState!=this.OPENED)throw new Error("INVALID_STATE_ERR: setRequestHeader can only be called when state is OPEN");if(!X(f))return console.warn('Refused to set unsafe header "'+f+'"'),!1;if(d)throw new Error("INVALID_STATE_ERR: send flag is true");return c[f]=m,!0},this.getResponseHeader=function(f){return typeof f=="string"&&this.readyState>this.OPENED&&i.headers[f.toLowerCase()]&&!g?i.headers[f.toLowerCase()]:null},this.getAllResponseHeaders=function(){if(this.readyState<this.HEADERS_RECEIVED||g)return"";var f="";for(var m in i.headers)m!=="set-cookie"&&m!=="set-cookie2"&&(f+=m+": "+i.headers[m]+`\r
`);return f.substr(0,f.length-2)},this.getRequestHeader=function(f){return typeof f=="string"&&c[f]?c[f]:""},this.send=function(f){if(this.readyState!=this.OPENED)throw new Error("INVALID_STATE_ERR: connection must be opened before send() is called");if(d)throw new Error("INVALID_STATE_ERR: send has already been called");var m=!1,O=!1,C=y.parse(o.url),L;switch(C.protocol){case"https:":m=!0;case"http:":L=C.hostname;break;case"file:":O=!0;break;case void 0:case"":L="localhost";break;default:throw new Error("Protocol not supported.")}if(O){if(o.method!=="GET")throw new Error("XMLHttpRequest: Only GET method is supported");if(o.async)y.readFile(unescape(C.pathname),"utf8",function(N,J){N?e.handleError(N,N.errno||-1):(e.status=200,e.responseText=J,k(e.DONE))});else try{this.responseText=y.readFileSync(unescape(C.pathname),"utf8"),this.status=200,k(e.DONE)}catch(N){this.handleError(N,N.errno||-1)}return}var re=C.port||(m?443:80),is=C.pathname+(C.search?C.search:"");if(c.Host=L,m&&re===443||re===80||(c.Host+=":"+C.port),o.user){typeof o.password>"u"&&(o.password="");var os=new Buffer(o.user+":"+o.password);c.Authorization="Basic "+os.toString("base64")}o.method==="GET"||o.method==="HEAD"?f=null:f?(c["Content-Length"]=Buffer.isBuffer(f)?f.length:Buffer.byteLength(f),c["Content-Type"]||(c["Content-Type"]="text/plain;charset=UTF-8")):o.method==="POST"&&(c["Content-Length"]=0);var as=s.agent||!1,U={host:L,port:re,path:is,method:o.method,headers:c,agent:as};if(m&&(U.pfx=s.pfx,U.key=s.key,U.passphrase=s.passphrase,U.cert=s.cert,U.ca=s.ca,U.ciphers=s.ciphers,U.rejectUnauthorized=s.rejectUnauthorized!==!1),g=!1,o.async){var et=m?r.request:t.request;d=!0,e.dispatchEvent("readystatechange");var tt=function(N){if(i=N,i.statusCode===302||i.statusCode===303||i.statusCode===307){o.url=i.headers.location;var J=y.parse(o.url);L=J.hostname;var q={hostname:J.hostname,port:J.port,path:J.path,method:i.statusCode===303?"GET":o.method,headers:c};m&&(q.pfx=s.pfx,q.key=s.key,q.passphrase=s.passphrase,q.cert=s.cert,q.ca=s.ca,q.ciphers=s.ciphers,q.rejectUnauthorized=s.rejectUnauthorized!==!1),n=et(q,tt).on("error",st),n.end();return}i&&i.setEncoding&&i.setEncoding("utf8"),k(e.HEADERS_RECEIVED),e.status=i.statusCode,i.on("data",function(ye){ye&&(e.responseText+=ye),d&&k(e.LOADING)}),i.on("end",function(){d&&(d=!1,k(e.DONE))}),i.on("error",function(ye){e.handleError(ye)})},st=function(N){e.handleError(N)};n=et(U,tt).on("error",st),s.autoUnref&&n.on("socket",N=>{N.unref()}),f&&n.write(f),n.end(),e.dispatchEvent("loadstart")}else{var ne=".node-xmlhttprequest-content-"+process.pid,ie=".node-xmlhttprequest-sync-"+process.pid;y.writeFileSync(ie,"","utf8");for(var cs="var http = require('http'), https = require('https'), fs = require('fs');var doRequest = http"+(m?"s":"")+".request;var options = "+JSON.stringify(U)+";var responseText = '';var req = doRequest(options, function(response) {response.setEncoding('utf8');response.on('data', function(chunk) {  responseText += chunk;});response.on('end', function() {fs.writeFileSync('"+ne+"', 'NODE-XMLHTTPREQUEST-STATUS:' + response.statusCode + ',' + responseText, 'utf8');fs.unlinkSync('"+ie+"');});response.on('error', function(error) {fs.writeFileSync('"+ne+"', 'NODE-XMLHTTPREQUEST-ERROR:' + JSON.stringify(error), 'utf8');fs.unlinkSync('"+ie+"');});}).on('error', function(error) {fs.writeFileSync('"+ne+"', 'NODE-XMLHTTPREQUEST-ERROR:' + JSON.stringify(error), 'utf8');fs.unlinkSync('"+ie+"');});"+(f?"req.write('"+JSON.stringify(f).slice(1,-1).replace(/'/g,"\\'")+"');":"")+"req.end();",hs=ws(process.argv[0],["-e",cs]);y.existsSync(ie););if(e.responseText=y.readFileSync(ne,"utf8"),hs.stdin.end(),y.unlinkSync(ne),e.responseText.match(/^NODE-XMLHTTPREQUEST-ERROR:/)){var ls=e.responseText.replace(/^NODE-XMLHTTPREQUEST-ERROR:/,"");e.handleError(ls,503)}else e.status=e.responseText.replace(/^NODE-XMLHTTPREQUEST-STATUS:([0-9]*),.*/,"$1"),e.responseText=e.responseText.replace(/^NODE-XMLHTTPREQUEST-STATUS:[0-9]*,(.*)/,"$1"),k(e.DONE)}},this.handleError=function(f,m){this.status=m||0,this.statusText=f,this.responseText=f.stack,g=!0,k(this.DONE)},this.abort=function(){n&&(n.abort(),n=null),c=Object.assign({},h),this.responseText="",this.responseXML="",g=v=!0,this.readyState!==this.UNSENT&&(this.readyState!==this.OPENED||d)&&this.readyState!==this.DONE&&(d=!1,k(this.DONE)),this.readyState=this.UNSENT},this.addEventListener=function(f,m){f in b||(b[f]=[]),b[f].push(m)},this.removeEventListener=function(f,m){f in b&&(b[f]=b[f].filter(function(O){return O!==m}))},this.dispatchEvent=function(f){if(typeof e["on"+f]=="function"&&(this.readyState===this.DONE?setImmediate(function(){e["on"+f]()}):e["on"+f]()),f in b)for(let m=0,O=b[f].length;m<O;m++)this.readyState===this.DONE?setImmediate(function(){b[f][m].call(e)}):b[f][m].call(e)};var k=function(f){if(!(e.readyState===f||e.readyState===e.UNSENT&&v)&&(e.readyState=f,(o.async||e.readyState<e.OPENED||e.readyState===e.DONE)&&e.dispatchEvent("readystatechange"),e.readyState===e.DONE)){let m;v?m="abort":g?m="error":m="load",e.dispatchEvent(m),e.dispatchEvent("loadend")}}}var Ts=Object.freeze(gs({__proto__:null,default:Ee,__moduleExports:Ee},[Ee]));const At=Ee||Ts;var fe=global;function Bt(s,...e){return e.reduce((t,r)=>(s.hasOwnProperty(r)&&(t[r]=s[r]),t),{})}const ks=setTimeout,Cs=clearTimeout;function Ce(s,e){e.useNativeTimers?(s.setTimeoutFn=ks.bind(fe),s.clearTimeoutFn=Cs.bind(fe)):(s.setTimeoutFn=setTimeout.bind(fe),s.clearTimeoutFn=clearTimeout.bind(fe))}var ee=T;function T(s){if(s)return Os(s)}function Os(s){for(var e in T.prototype)s[e]=T.prototype[e];return s}T.prototype.on=T.prototype.addEventListener=function(s,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+s]=this._callbacks["$"+s]||[]).push(e),this};T.prototype.once=function(s,e){function t(){this.off(s,t),e.apply(this,arguments)}return t.fn=e,this.on(s,t),this};T.prototype.off=T.prototype.removeListener=T.prototype.removeAllListeners=T.prototype.removeEventListener=function(s,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+s];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+s],this;for(var r,n=0;n<t.length;n++)if(r=t[n],r===e||r.fn===e){t.splice(n,1);break}return t.length===0&&delete this._callbacks["$"+s],this};T.prototype.emit=function(s){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+s],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(t){t=t.slice(0);for(var r=0,n=t.length;r<n;++r)t[r].apply(this,e)}return this};T.prototype.emitReserved=T.prototype.emit;T.prototype.listeners=function(s){return this._callbacks=this._callbacks||{},this._callbacks["$"+s]||[]};T.prototype.hasListeners=function(s){return!!this.listeners(s).length};const D=Object.create(null);D.open="0";D.close="1";D.ping="2";D.pong="3";D.message="4";D.upgrade="5";D.noop="6";const be=Object.create(null);Object.keys(D).forEach(s=>{be[D[s]]=s});const Ns={type:"error",data:"parser error"},Pt=({type:s,data:e},t,r)=>{if(e instanceof ArrayBuffer||ArrayBuffer.isView(e)){const n=Rs(e);return r(Ls(n,t))}return r(D[s]+(e||""))},Rs=s=>Buffer.isBuffer(s)?s:s instanceof ArrayBuffer?Buffer.from(s):Buffer.from(s.buffer,s.byteOffset,s.byteLength),Ls=(s,e)=>e?s:"b"+s.toString("base64"),Dt=(s,e)=>{if(typeof s!="string")return{type:"message",data:nt(s,e)};const t=s.charAt(0);if(t==="b"){const r=Buffer.from(s.substring(1),"base64");return{type:"message",data:nt(r,e)}}return be[t]?s.length>1?{type:be[t],data:s.substring(1)}:{type:be[t]}:Ns},nt=(s,e)=>{const t=Buffer.isBuffer(s);switch(e){case"arraybuffer":return t?As(s):s;case"nodebuffer":default:return s}},As=s=>{const e=new ArrayBuffer(s.length),t=new Uint8Array(e);for(let r=0;r<s.length;r++)t[r]=s[r];return e},It="",Bs=(s,e)=>{const t=s.length,r=new Array(t);let n=0;s.forEach((i,o)=>{Pt(i,!1,a=>{r[o]=a,++n===t&&e(r.join(It))})})},Ps=(s,e)=>{const t=s.split(It),r=[];for(let n=0;n<t.length;n++){const i=Dt(t[n],e);if(r.push(i),i.type==="error")break}return r},Ut=4;class Mt extends ee{constructor(e){super(),this.writable=!1,Ce(this,e),this.opts=e,this.query=e.query,this.readyState="",this.socket=e.socket}onError(e,t){const r=new Error(e);return r.type="TransportError",r.description=t,super.emit("error",r),this}open(){return(this.readyState==="closed"||this.readyState==="")&&(this.readyState="opening",this.doOpen()),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emit("open")}onData(e){const t=Dt(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emit("packet",e)}onClose(){this.readyState="closed",super.emit("close")}}var Ft="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),we=64,$t={},it=0,H=0,ot;function qe(s){var e="";do e=Ft[s%we]+e,s=Math.floor(s/we);while(s>0);return e}function Ds(s){var e=0;for(H=0;H<s.length;H++)e=e*we+$t[s.charAt(H)];return e}function Ge(){var s=qe(+new Date);return s!==ot?(it=0,ot=s):s+"."+qe(it++)}for(;H<we;H++)$t[Ft[H]]=H;Ge.encode=qe;Ge.decode=Ds;var qt=Ge,Is=function(s){var e="";for(var t in s)s.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(s[t]));return e},Us=function(s){for(var e={},t=s.split("&"),r=0,n=t.length;r<n;r++){var i=t[r].split("=");e[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return e},ze={encode:Is,decode:Us};class Ms extends Mt{constructor(){super(...arguments),this.polling=!1}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let r=0;this.polling&&(r++,this.once("pollComplete",function(){--r||t()})),this.writable||(r++,this.once("drain",function(){--r||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emit("poll")}onData(e){const t=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose(),!1;this.onPacket(r)};Ps(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this.polling=!1,this.emit("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,Bs(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emit("drain")})})}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let r="";this.opts.timestampRequests!==!1&&(e[this.opts.timestampParam]=qt()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.opts.port&&(t==="https"&&Number(this.opts.port)!==443||t==="http"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port);const n=ze.encode(e),i=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(i?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(n.length?"?"+n:"")}}function Fs(){}const $s=function(){return new At({xdomain:!1}).responseType!=null}();class qs extends Ms{constructor(e){if(super(e),typeof location<"u"){const r=location.protocol==="https:";let n=location.port;n||(n=r?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||n!==e.port,this.xs=e.secure!==r}const t=e&&e.forceBase64;this.supportsBinary=$s&&!t}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new P(this.uri(),e)}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",n=>{this.onError("xhr post error",n)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",t=>{this.onError("xhr poll error",t)}),this.pollXhr=e}}class P extends ee{constructor(e,t){super(),Ce(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=t.async!==!1,this.data=t.data!==void 0?t.data:null,this.create()}create(){const e=Bt(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new At(e);try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let r in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(r)&&t.setRequestHeader(r,this.opts.extraHeaders[r])}}catch{}if(this.method==="POST")try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{t.setRequestHeader("Accept","*/*")}catch{}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{t.readyState===4&&(t.status===200||t.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof t.status=="number"?t.status:0)},0))},t.send(this.data)}catch(r){this.setTimeoutFn(()=>{this.onError(r)},0);return}typeof document<"u"&&(this.index=P.requestsCount++,P.requests[this.index]=this)}onSuccess(){this.emit("success"),this.cleanup()}onData(e){this.emit("data",e),this.onSuccess()}onError(e){this.emit("error",e),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=Fs,e)try{this.xhr.abort()}catch{}typeof document<"u"&&delete P.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&this.onData(e)}abort(){this.cleanup()}}P.requestsCount=0;P.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",at);else if(typeof addEventListener=="function"){const s="onpagehide"in fe?"pagehide":"unload";addEventListener(s,at,!1)}}function at(){for(let s in P.requests)P.requests.hasOwnProperty(s)&&P.requests[s].abort()}function Vt(s,e,t){return t={path:e,exports:{},require:function(r,n){return Vs(r,n??t.path)}},s(t,t.exports),t.exports}function Vs(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var Y={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}},me=Vt(function(s){const{EMPTY_BUFFER:e}=Y;function t(a,h){if(a.length===0)return e;if(a.length===1)return a[0];const c=Buffer.allocUnsafe(h);let u=0;for(let l=0;l<a.length;l++){const d=a[l];c.set(d,u),u+=d.length}return u<h?c.slice(0,u):c}function r(a,h,c,u,l){for(let d=0;d<l;d++)c[u+d]=a[d]^h[d&3]}function n(a,h){for(let c=0;c<a.length;c++)a[c]^=h[c&3]}function i(a){return a.byteLength===a.buffer.byteLength?a.buffer:a.buffer.slice(a.byteOffset,a.byteOffset+a.byteLength)}function o(a){if(o.readOnly=!0,Buffer.isBuffer(a))return a;let h;return a instanceof ArrayBuffer?h=Buffer.from(a):ArrayBuffer.isView(a)?h=Buffer.from(a.buffer,a.byteOffset,a.byteLength):(h=Buffer.from(a),o.readOnly=!1),h}try{const a=require("bufferutil");s.exports={concat:t,mask(h,c,u,l,d){d<48?r(h,c,u,l,d):a.mask(h,c,u,l,d)},toArrayBuffer:i,toBuffer:o,unmask(h,c){h.length<32?n(h,c):a.unmask(h,c)}}}catch{s.exports={concat:t,mask:r,toArrayBuffer:i,toBuffer:o,unmask:n}}});const ct=Symbol("kDone"),Le=Symbol("kRun");class Ws{constructor(e){this[ct]=()=>{this.pending--,this[Le]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[Le]()}[Le](){if(this.pending!==this.concurrency&&this.jobs.length){const e=this.jobs.shift();this.pending++,e(this[ct])}}}var js=Ws;const{kStatusCode:Wt}=Y,Hs=Buffer.from([0,0,255,255]),Te=Symbol("permessage-deflate"),F=Symbol("total-length"),ue=Symbol("callback"),V=Symbol("buffers"),Se=Symbol("error");let ge;class Gs{constructor(e,t,r){if(this._maxPayload=r|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!ge){const n=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;ge=new js(n)}}static get extensionName(){return"permessage-deflate"}offer(){const e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){const e=this._deflate[ue];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){const t=this._options,r=e.find(n=>!(t.serverNoContextTakeover===!1&&n.server_no_context_takeover||n.server_max_window_bits&&(t.serverMaxWindowBits===!1||typeof t.serverMaxWindowBits=="number"&&t.serverMaxWindowBits>n.server_max_window_bits)||typeof t.clientMaxWindowBits=="number"&&!n.client_max_window_bits));if(!r)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(r.server_no_context_takeover=!0),t.clientNoContextTakeover&&(r.client_no_context_takeover=!0),typeof t.serverMaxWindowBits=="number"&&(r.server_max_window_bits=t.serverMaxWindowBits),typeof t.clientMaxWindowBits=="number"?r.client_max_window_bits=t.clientMaxWindowBits:(r.client_max_window_bits===!0||t.clientMaxWindowBits===!1)&&delete r.client_max_window_bits,r}acceptAsClient(e){const t=e[0];if(this._options.clientNoContextTakeover===!1&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!t.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(t.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return t}normalizeParams(e){return e.forEach(t=>{Object.keys(t).forEach(r=>{let n=t[r];if(n.length>1)throw new Error(`Parameter "${r}" must have only a single value`);if(n=n[0],r==="client_max_window_bits"){if(n!==!0){const i=+n;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError(`Invalid value for parameter "${r}": ${n}`);n=i}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${r}": ${n}`)}else if(r==="server_max_window_bits"){const i=+n;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError(`Invalid value for parameter "${r}": ${n}`);n=i}else if(r==="client_no_context_takeover"||r==="server_no_context_takeover"){if(n!==!0)throw new TypeError(`Invalid value for parameter "${r}": ${n}`)}else throw new Error(`Unknown parameter "${r}"`);t[r]=n})}),e}decompress(e,t,r){ge.add(n=>{this._decompress(e,t,(i,o)=>{n(),r(i,o)})})}compress(e,t,r){ge.add(n=>{this._compress(e,t,(i,o)=>{n(),r(i,o)})})}_decompress(e,t,r){const n=this._isServer?"client":"server";if(!this._inflate){const i=`${n}_max_window_bits`,o=typeof this.params[i]!="number"?y.Z_DEFAULT_WINDOWBITS:this.params[i];this._inflate=y.createInflateRaw({...this._options.zlibInflateOptions,windowBits:o}),this._inflate[Te]=this,this._inflate[F]=0,this._inflate[V]=[],this._inflate.on("error",Ys),this._inflate.on("data",jt)}this._inflate[ue]=r,this._inflate.write(e),t&&this._inflate.write(Hs),this._inflate.flush(()=>{const i=this._inflate[Se];if(i){this._inflate.close(),this._inflate=null,r(i);return}const o=me.concat(this._inflate[V],this._inflate[F]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[F]=0,this._inflate[V]=[],t&&this.params[`${n}_no_context_takeover`]&&this._inflate.reset()),r(null,o)})}_compress(e,t,r){const n=this._isServer?"server":"client";if(!this._deflate){const i=`${n}_max_window_bits`,o=typeof this.params[i]!="number"?y.Z_DEFAULT_WINDOWBITS:this.params[i];this._deflate=y.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:o}),this._deflate[F]=0,this._deflate[V]=[],this._deflate.on("data",zs)}this._deflate[ue]=r,this._deflate.write(e),this._deflate.flush(y.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let i=me.concat(this._deflate[V],this._deflate[F]);t&&(i=i.slice(0,i.length-4)),this._deflate[ue]=null,this._deflate[F]=0,this._deflate[V]=[],t&&this.params[`${n}_no_context_takeover`]&&this._deflate.reset(),r(null,i)})}}var x=Gs;function zs(s){this[V].push(s),this[F]+=s.length}function jt(s){if(this[F]+=s.length,this[Te]._maxPayload<1||this[F]<=this[Te]._maxPayload){this[V].push(s);return}this[Se]=new RangeError("Max payload size exceeded"),this[Se].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[Se][Wt]=1009,this.removeListener("data",jt),this.reset()}function Ys(s){this[Te]._inflate=null,s[Wt]=1007,this[ue](s)}var Oe=Vt(function(s){const e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function t(n){return n>=1e3&&n<=1014&&n!==1004&&n!==1005&&n!==1006||n>=3e3&&n<=4999}function r(n){const i=n.length;let o=0;for(;o<i;)if(!(n[o]&128))o++;else if((n[o]&224)===192){if(o+1===i||(n[o+1]&192)!==128||(n[o]&254)===192)return!1;o+=2}else if((n[o]&240)===224){if(o+2>=i||(n[o+1]&192)!==128||(n[o+2]&192)!==128||n[o]===224&&(n[o+1]&224)===128||n[o]===237&&(n[o+1]&224)===160)return!1;o+=3}else if((n[o]&248)===240){if(o+3>=i||(n[o+1]&192)!==128||(n[o+2]&192)!==128||(n[o+3]&192)!==128||n[o]===240&&(n[o+1]&240)===128||n[o]===244&&n[o+1]>143||n[o]>244)return!1;o+=4}else return!1;return!0}try{const n=require("utf-8-validate");s.exports={isValidStatusCode:t,isValidUTF8(i){return i.length<150?r(i):n(i)},tokenChars:e}}catch{s.exports={isValidStatusCode:t,isValidUTF8:r,tokenChars:e}}});const{Writable:Ks}=y,{BINARY_TYPES:Xs,EMPTY_BUFFER:ht,kStatusCode:Js,kWebSocket:Qs}=Y,{concat:Ae,toArrayBuffer:Zs,unmask:er}=me,{isValidStatusCode:tr,isValidUTF8:lt}=Oe,oe=0,ft=1,ut=2,dt=3,Be=4,sr=5;class rr extends Ks{constructor(e={}){super(),this._binaryType=e.binaryType||Xs[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=e.maxPayload|0,this._skipUTF8Validation=!!e.skipUTF8Validation,this[Qs]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=oe,this._loop=!1}_write(e,t,r){if(this._opcode===8&&this._state==oe)return r();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(r)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){const r=this._buffers[0];return this._buffers[0]=r.slice(e),r.slice(0,e)}const t=Buffer.allocUnsafe(e);do{const r=this._buffers[0],n=t.length-e;e>=r.length?t.set(this._buffers.shift(),n):(t.set(new Uint8Array(r.buffer,r.byteOffset,e),n),this._buffers[0]=r.slice(e)),e-=r.length}while(e>0);return t}startLoop(e){let t;this._loop=!0;do switch(this._state){case oe:t=this.getInfo();break;case ft:t=this.getPayloadLength16();break;case ut:t=this.getPayloadLength64();break;case dt:this.getMask();break;case Be:t=this.getData(e);break;default:this._loop=!1;return}while(this._loop);e(t)}getInfo(){if(this._bufferedBytes<2){this._loop=!1;return}const e=this.consume(2);if(e[0]&48)return this._loop=!1,S(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");const t=(e[0]&64)===64;if(t&&!this._extensions[x.extensionName])return this._loop=!1,S(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._fin=(e[0]&128)===128,this._opcode=e[0]&15,this._payloadLength=e[1]&127,this._opcode===0){if(t)return this._loop=!1,S(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(!this._fragmented)return this._loop=!1,S(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented)return this._loop=!1,S(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");this._compressed=t}else if(this._opcode>7&&this._opcode<11){if(!this._fin)return this._loop=!1,S(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");if(t)return this._loop=!1,S(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._payloadLength>125)return this._loop=!1,S(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH")}else return this._loop=!1,S(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(e[1]&128)===128,this._isServer){if(!this._masked)return this._loop=!1,S(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK")}else if(this._masked)return this._loop=!1,S(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");if(this._payloadLength===126)this._state=ft;else if(this._payloadLength===127)this._state=ut;else return this.haveLength()}getPayloadLength16(){if(this._bufferedBytes<2){this._loop=!1;return}return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength()}getPayloadLength64(){if(this._bufferedBytes<8){this._loop=!1;return}const e=this.consume(8),t=e.readUInt32BE(0);return t>Math.pow(2,21)-1?(this._loop=!1,S(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=t*Math.pow(2,32)+e.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,S(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");this._masked?this._state=dt:this._state=Be}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=Be}getData(e){let t=ht;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}t=this.consume(this._payloadLength),this._masked&&er(t,this._mask)}if(this._opcode>7)return this.controlMessage(t);if(this._compressed){this._state=sr,this.decompress(t,e);return}return t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage()}decompress(e,t){this._extensions[x.extensionName].decompress(e,this._fin,(n,i)=>{if(n)return t(n);if(i.length){if(this._messageLength+=i.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return t(S(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));this._fragments.push(i)}const o=this.dataMessage();if(o)return t(o);this.startLoop(t)})}dataMessage(){if(this._fin){const e=this._messageLength,t=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let r;this._binaryType==="nodebuffer"?r=Ae(t,e):this._binaryType==="arraybuffer"?r=Zs(Ae(t,e)):r=t,this.emit("message",r,!0)}else{const r=Ae(t,e);if(!this._skipUTF8Validation&&!lt(r))return this._loop=!1,S(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("message",r,!1)}}this._state=oe}controlMessage(e){if(this._opcode===8)if(this._loop=!1,e.length===0)this.emit("conclude",1005,ht),this.end();else{if(e.length===1)return S(RangeError,"invalid payload length 1",!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");{const t=e.readUInt16BE(0);if(!tr(t))return S(RangeError,`invalid status code ${t}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");const r=e.slice(2);if(!this._skipUTF8Validation&&!lt(r))return S(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("conclude",t,r),this.end()}}else this._opcode===9?this.emit("ping",e):this.emit("pong",e);this._state=oe}}var Ht=rr;function S(s,e,t,r,n){const i=new s(t?`Invalid WebSocket frame: ${e}`:e);return Error.captureStackTrace(i,S),i.code=n,i[Js]=r,i}const{randomFillSync:nr}=y,{EMPTY_BUFFER:ir}=Y,{isValidStatusCode:or}=Oe,{mask:pt,toBuffer:M}=me,G=Buffer.alloc(4);class W{constructor(e,t){this._extensions=t||{},this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,t){const r=t.mask&&t.readOnly;let n=t.mask?6:2,i=e.length;e.length>=65536?(n+=8,i=127):e.length>125&&(n+=2,i=126);const o=Buffer.allocUnsafe(r?e.length+n:n);return o[0]=t.fin?t.opcode|128:t.opcode,t.rsv1&&(o[0]|=64),o[1]=i,i===126?o.writeUInt16BE(e.length,2):i===127&&(o.writeUInt32BE(0,2),o.writeUInt32BE(e.length,6)),t.mask?(nr(G,0,4),o[1]|=128,o[n-4]=G[0],o[n-3]=G[1],o[n-2]=G[2],o[n-1]=G[3],r?(pt(e,G,o,n,e.length),[o]):(pt(e,G,e,0,e.length),[o,e])):[o,e]}close(e,t,r,n){let i;if(e===void 0)i=ir;else{if(typeof e!="number"||!or(e))throw new TypeError("First argument must be a valid error code number");if(t===void 0||!t.length)i=Buffer.allocUnsafe(2),i.writeUInt16BE(e,0);else{const o=Buffer.byteLength(t);if(o>123)throw new RangeError("The message must not be greater than 123 bytes");i=Buffer.allocUnsafe(2+o),i.writeUInt16BE(e,0),typeof t=="string"?i.write(t,2):i.set(t,2)}}this._deflating?this.enqueue([this.doClose,i,r,n]):this.doClose(i,r,n)}doClose(e,t,r){this.sendFrame(W.frame(e,{fin:!0,rsv1:!1,opcode:8,mask:t,readOnly:!1}),r)}ping(e,t,r){const n=M(e);if(n.length>125)throw new RangeError("The data size must not be greater than 125 bytes");this._deflating?this.enqueue([this.doPing,n,t,M.readOnly,r]):this.doPing(n,t,M.readOnly,r)}doPing(e,t,r,n){this.sendFrame(W.frame(e,{fin:!0,rsv1:!1,opcode:9,mask:t,readOnly:r}),n)}pong(e,t,r){const n=M(e);if(n.length>125)throw new RangeError("The data size must not be greater than 125 bytes");this._deflating?this.enqueue([this.doPong,n,t,M.readOnly,r]):this.doPong(n,t,M.readOnly,r)}doPong(e,t,r,n){this.sendFrame(W.frame(e,{fin:!0,rsv1:!1,opcode:10,mask:t,readOnly:r}),n)}send(e,t,r){const n=M(e),i=this._extensions[x.extensionName];let o=t.binary?2:1,a=t.compress;if(this._firstFragment?(this._firstFragment=!1,a&&i&&i.params[i._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(a=n.length>=i._threshold),this._compress=a):(a=!1,o=0),t.fin&&(this._firstFragment=!0),i){const h={fin:t.fin,rsv1:a,opcode:o,mask:t.mask,readOnly:M.readOnly};this._deflating?this.enqueue([this.dispatch,n,this._compress,h,r]):this.dispatch(n,this._compress,h,r)}else this.sendFrame(W.frame(n,{fin:t.fin,rsv1:!1,opcode:o,mask:t.mask,readOnly:M.readOnly}),r)}dispatch(e,t,r,n){if(!t){this.sendFrame(W.frame(e,r),n);return}const i=this._extensions[x.extensionName];this._bufferedBytes+=e.length,this._deflating=!0,i.compress(e,r.fin,(o,a)=>{if(this._socket.destroyed){const h=new Error("The socket was closed while data was being compressed");typeof n=="function"&&n(h);for(let c=0;c<this._queue.length;c++){const u=this._queue[c][4];typeof u=="function"&&u(h)}return}this._bufferedBytes-=e.length,this._deflating=!1,r.readOnly=!1,this.sendFrame(W.frame(a,r),n),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){const e=this._queue.shift();this._bufferedBytes-=e[1].length,Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[1].length,this._queue.push(e)}sendFrame(e,t){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}}var Gt=W;const{kForOnEventAttribute:Pe,kListener:mt}=Y,_t=Symbol("kCode"),yt=Symbol("kData"),gt=Symbol("kError"),vt=Symbol("kMessage"),Et=Symbol("kReason"),Z=Symbol("kTarget"),bt=Symbol("kType"),St=Symbol("kWasClean");class K{constructor(e){this[Z]=null,this[bt]=e}get target(){return this[Z]}get type(){return this[bt]}}Object.defineProperty(K.prototype,"target",{enumerable:!0});Object.defineProperty(K.prototype,"type",{enumerable:!0});class _e extends K{constructor(e,t={}){super(e),this[_t]=t.code===void 0?0:t.code,this[Et]=t.reason===void 0?"":t.reason,this[St]=t.wasClean===void 0?!1:t.wasClean}get code(){return this[_t]}get reason(){return this[Et]}get wasClean(){return this[St]}}Object.defineProperty(_e.prototype,"code",{enumerable:!0});Object.defineProperty(_e.prototype,"reason",{enumerable:!0});Object.defineProperty(_e.prototype,"wasClean",{enumerable:!0});class Ne extends K{constructor(e,t={}){super(e),this[gt]=t.error===void 0?null:t.error,this[vt]=t.message===void 0?"":t.message}get error(){return this[gt]}get message(){return this[vt]}}Object.defineProperty(Ne.prototype,"error",{enumerable:!0});Object.defineProperty(Ne.prototype,"message",{enumerable:!0});class Ye extends K{constructor(e,t={}){super(e),this[yt]=t.data===void 0?null:t.data}get data(){return this[yt]}}Object.defineProperty(Ye.prototype,"data",{enumerable:!0});const ar={addEventListener(s,e,t={}){let r;if(s==="message")r=function(i,o){const a=new Ye("message",{data:o?i:i.toString()});a[Z]=this,e.call(this,a)};else if(s==="close")r=function(i,o){const a=new _e("close",{code:i,reason:o.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});a[Z]=this,e.call(this,a)};else if(s==="error")r=function(i){const o=new Ne("error",{error:i,message:i.message});o[Z]=this,e.call(this,o)};else if(s==="open")r=function(){const i=new K("open");i[Z]=this,e.call(this,i)};else return;r[Pe]=!!t[Pe],r[mt]=e,t.once?this.once(s,r):this.on(s,r)},removeEventListener(s,e){for(const t of this.listeners(s))if(t[mt]===e&&!t[Pe]){this.removeListener(s,t);break}}};var cr={CloseEvent:_e,ErrorEvent:Ne,Event:K,EventTarget:ar,MessageEvent:Ye};const{tokenChars:ae}=Oe;function B(s,e,t){s[e]===void 0?s[e]=[t]:s[e].push(t)}function hr(s){const e=Object.create(null);let t=Object.create(null),r=!1,n=!1,i=!1,o,a,h=-1,c=-1,u=-1,l=0;for(;l<s.length;l++)if(c=s.charCodeAt(l),o===void 0)if(u===-1&&ae[c]===1)h===-1&&(h=l);else if(l!==0&&(c===32||c===9))u===-1&&h!==-1&&(u=l);else if(c===59||c===44){if(h===-1)throw new SyntaxError(`Unexpected character at index ${l}`);u===-1&&(u=l);const g=s.slice(h,u);c===44?(B(e,g,t),t=Object.create(null)):o=g,h=u=-1}else throw new SyntaxError(`Unexpected character at index ${l}`);else if(a===void 0)if(u===-1&&ae[c]===1)h===-1&&(h=l);else if(c===32||c===9)u===-1&&h!==-1&&(u=l);else if(c===59||c===44){if(h===-1)throw new SyntaxError(`Unexpected character at index ${l}`);u===-1&&(u=l),B(t,s.slice(h,u),!0),c===44&&(B(e,o,t),t=Object.create(null),o=void 0),h=u=-1}else if(c===61&&h!==-1&&u===-1)a=s.slice(h,l),h=u=-1;else throw new SyntaxError(`Unexpected character at index ${l}`);else if(n){if(ae[c]!==1)throw new SyntaxError(`Unexpected character at index ${l}`);h===-1?h=l:r||(r=!0),n=!1}else if(i)if(ae[c]===1)h===-1&&(h=l);else if(c===34&&h!==-1)i=!1,u=l;else if(c===92)n=!0;else throw new SyntaxError(`Unexpected character at index ${l}`);else if(c===34&&s.charCodeAt(l-1)===61)i=!0;else if(u===-1&&ae[c]===1)h===-1&&(h=l);else if(h!==-1&&(c===32||c===9))u===-1&&(u=l);else if(c===59||c===44){if(h===-1)throw new SyntaxError(`Unexpected character at index ${l}`);u===-1&&(u=l);let g=s.slice(h,u);r&&(g=g.replace(/\\/g,""),r=!1),B(t,a,g),c===44&&(B(e,o,t),t=Object.create(null),o=void 0),a=void 0,h=u=-1}else throw new SyntaxError(`Unexpected character at index ${l}`);if(h===-1||i||c===32||c===9)throw new SyntaxError("Unexpected end of input");u===-1&&(u=l);const d=s.slice(h,u);return o===void 0?B(e,d,t):(a===void 0?B(t,d,!0):r?B(t,a,d.replace(/\\/g,"")):B(t,a,d),B(e,o,t)),e}function lr(s){return Object.keys(s).map(e=>{let t=s[e];return Array.isArray(t)||(t=[t]),t.map(r=>[e].concat(Object.keys(r).map(n=>{let i=r[n];return Array.isArray(i)||(i=[i]),i.map(o=>o===!0?n:`${n}=${o}`).join("; ")})).join("; ")).join(", ")}).join(", ")}var Ve={format:lr,parse:hr};const{randomBytes:fr,createHash:ur}=y,{URL:De}=y,{BINARY_TYPES:xt,EMPTY_BUFFER:ve,GUID:dr,kForOnEventAttribute:Ie,kListener:pr,kStatusCode:mr,kWebSocket:w,NOOP:zt}=Y,{EventTarget:{addEventListener:_r,removeEventListener:yr}}=cr,{format:gr,parse:vr}=Ve,{toBuffer:Er}=me,$=["CONNECTING","OPEN","CLOSING","CLOSED"],br=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/,Ue=[8,13],Sr=30*1e3;class p extends y{constructor(e,t,r){super(),this._binaryType=xt[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=ve,this._closeTimer=null,this._extensions={},this._protocol="",this._readyState=p.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,t===void 0?t=[]:Array.isArray(t)||(typeof t=="object"&&t!==null?(r=t,t=[]):t=[t]),Yt(this,e,t,r)):this._isServer=!0}get binaryType(){return this._binaryType}set binaryType(e){xt.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,r){const n=new Ht({binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:r.maxPayload,skipUTF8Validation:r.skipUTF8Validation});this._sender=new Gt(e,this._extensions),this._receiver=n,this._socket=e,n[w]=this,e[w]=this,n.on("conclude",Tr),n.on("drain",kr),n.on("error",Cr),n.on("message",Or),n.on("ping",Nr),n.on("pong",Rr),e.setTimeout(0),e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",Xt),e.on("data",Re),e.on("end",Jt),e.on("error",Qt),this._readyState=p.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=p.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[x.extensionName]&&this._extensions[x.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=p.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==p.CLOSED){if(this.readyState===p.CONNECTING)return R(this,this._req,"WebSocket was closed before the connection was established");if(this.readyState===p.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=p.CLOSING,this._sender.close(e,t,!this._isServer,r=>{r||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),Sr)}}ping(e,t,r){if(this.readyState===p.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(r=e,e=t=void 0):typeof t=="function"&&(r=t,t=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==p.OPEN){Me(this,e,r);return}t===void 0&&(t=!this._isServer),this._sender.ping(e||ve,t,r)}pong(e,t,r){if(this.readyState===p.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(r=e,e=t=void 0):typeof t=="function"&&(r=t,t=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==p.OPEN){Me(this,e,r);return}t===void 0&&(t=!this._isServer),this._sender.pong(e||ve,t,r)}send(e,t,r){if(this.readyState===p.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof t=="function"&&(r=t,t={}),typeof e=="number"&&(e=e.toString()),this.readyState!==p.OPEN){Me(this,e,r);return}const n={binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[x.extensionName]||(n.compress=!1),this._sender.send(e||ve,n,r)}terminate(){if(this.readyState!==p.CLOSED){if(this.readyState===p.CONNECTING)return R(this,this._req,"WebSocket was closed before the connection was established");this._socket&&(this._readyState=p.CLOSING,this._socket.destroy())}}}Object.defineProperty(p,"CONNECTING",{enumerable:!0,value:$.indexOf("CONNECTING")});Object.defineProperty(p.prototype,"CONNECTING",{enumerable:!0,value:$.indexOf("CONNECTING")});Object.defineProperty(p,"OPEN",{enumerable:!0,value:$.indexOf("OPEN")});Object.defineProperty(p.prototype,"OPEN",{enumerable:!0,value:$.indexOf("OPEN")});Object.defineProperty(p,"CLOSING",{enumerable:!0,value:$.indexOf("CLOSING")});Object.defineProperty(p.prototype,"CLOSING",{enumerable:!0,value:$.indexOf("CLOSING")});Object.defineProperty(p,"CLOSED",{enumerable:!0,value:$.indexOf("CLOSED")});Object.defineProperty(p.prototype,"CLOSED",{enumerable:!0,value:$.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","protocol","readyState","url"].forEach(s=>{Object.defineProperty(p.prototype,s,{enumerable:!0})});["open","error","close","message"].forEach(s=>{Object.defineProperty(p.prototype,`on${s}`,{enumerable:!0,get(){for(const e of this.listeners(s))if(e[Ie])return e[pr];return null},set(e){for(const t of this.listeners(s))if(t[Ie]){this.removeListener(s,t);break}typeof e=="function"&&this.addEventListener(s,e,{[Ie]:!0})}})});p.prototype.addEventListener=_r;p.prototype.removeEventListener=yr;var I=p;function Yt(s,e,t,r){const n={protocolVersion:Ue[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...r,createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:void 0,host:void 0,path:void 0,port:void 0};if(!Ue.includes(n.protocolVersion))throw new RangeError(`Unsupported protocol version: ${n.protocolVersion} (supported versions: ${Ue.join(", ")})`);let i;if(e instanceof De)i=e,s._url=e.href;else{try{i=new De(e)}catch{throw new SyntaxError(`Invalid URL: ${e}`)}s._url=e}const o=i.protocol==="wss:",a=i.protocol==="ws+unix:";if(i.protocol!=="ws:"&&!o&&!a)throw new SyntaxError(`The URL's protocol must be one of "ws:", "wss:", or "ws+unix:"`);if(a&&!i.pathname)throw new SyntaxError("The URL's pathname is empty");if(i.hash)throw new SyntaxError("The URL contains a fragment identifier");const h=o?443:80,c=fr(16).toString("base64"),u=y.get,l=new Set;let d;if(n.createConnection=o?wr:xr,n.defaultPort=n.defaultPort||h,n.port=i.port||h,n.host=i.hostname.startsWith("[")?i.hostname.slice(1,-1):i.hostname,n.headers={"Sec-WebSocket-Version":n.protocolVersion,"Sec-WebSocket-Key":c,Connection:"Upgrade",Upgrade:"websocket",...n.headers},n.path=i.pathname+i.search,n.timeout=n.handshakeTimeout,n.perMessageDeflate&&(d=new x(n.perMessageDeflate!==!0?n.perMessageDeflate:{},!1,n.maxPayload),n.headers["Sec-WebSocket-Extensions"]=gr({[x.extensionName]:d.offer()})),t.length){for(const v of t){if(typeof v!="string"||!br.test(v)||l.has(v))throw new SyntaxError("An invalid or duplicated subprotocol was specified");l.add(v)}n.headers["Sec-WebSocket-Protocol"]=t.join(",")}if(n.origin&&(n.protocolVersion<13?n.headers["Sec-WebSocket-Origin"]=n.origin:n.headers.Origin=n.origin),(i.username||i.password)&&(n.auth=`${i.username}:${i.password}`),a){const v=n.path.split(":");n.socketPath=v[0],n.path=v[1]}let g=s._req=u(n);n.timeout&&g.on("timeout",()=>{R(s,g,"Opening handshake has timed out")}),g.on("error",v=>{g===null||g.aborted||(g=s._req=null,s._readyState=p.CLOSING,s.emit("error",v),s.emitClose())}),g.on("response",v=>{const b=v.headers.location,X=v.statusCode;if(b&&n.followRedirects&&X>=300&&X<400){if(++s._redirects>n.maxRedirects){R(s,g,"Maximum redirects exceeded");return}g.abort();const se=new De(b,e);Yt(s,se,t,r)}else s.emit("unexpected-response",g,v)||R(s,g,`Unexpected server response: ${v.statusCode}`)}),g.on("upgrade",(v,b,X)=>{if(s.emit("upgrade",v),s.readyState!==p.CONNECTING)return;g=s._req=null;const se=ur("sha1").update(c+dr).digest("base64");if(v.headers["sec-websocket-accept"]!==se){R(s,b,"Invalid Sec-WebSocket-Accept header");return}const k=v.headers["sec-websocket-protocol"];let f;if(k!==void 0?l.size?l.has(k)||(f="Server sent an invalid subprotocol"):f="Server sent a subprotocol but none was requested":l.size&&(f="Server sent no subprotocol"),f){R(s,b,f);return}k&&(s._protocol=k);const m=v.headers["sec-websocket-extensions"];if(m!==void 0){if(!d){R(s,b,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let O;try{O=vr(m)}catch{R(s,b,"Invalid Sec-WebSocket-Extensions header");return}const C=Object.keys(O);if(C.length!==1||C[0]!==x.extensionName){R(s,b,"Server indicated an extension that was not requested");return}try{d.accept(O[x.extensionName])}catch{R(s,b,"Invalid Sec-WebSocket-Extensions header");return}s._extensions[x.extensionName]=d}s.setSocket(b,X,{maxPayload:n.maxPayload,skipUTF8Validation:n.skipUTF8Validation})})}function xr(s){return s.path=s.socketPath,y.connect(s)}function wr(s){return s.path=void 0,!s.servername&&s.servername!==""&&(s.servername=y.isIP(s.host)?"":s.host),y.connect(s)}function R(s,e,t){s._readyState=p.CLOSING;const r=new Error(t);Error.captureStackTrace(r,R),e.setHeader?(e.abort(),e.socket&&!e.socket.destroyed&&e.socket.destroy(),e.once("abort",s.emitClose.bind(s)),s.emit("error",r)):(e.destroy(r),e.once("error",s.emit.bind(s,"error")),e.once("close",s.emitClose.bind(s)))}function Me(s,e,t){if(e){const r=Er(e).length;s._socket?s._sender._bufferedBytes+=r:s._bufferedAmount+=r}if(t){const r=new Error(`WebSocket is not open: readyState ${s.readyState} (${$[s.readyState]})`);t(r)}}function Tr(s,e){const t=this[w];t._closeFrameReceived=!0,t._closeMessage=e,t._closeCode=s,t._socket[w]!==void 0&&(t._socket.removeListener("data",Re),process.nextTick(Kt,t._socket),s===1005?t.close():t.close(s,e))}function kr(){this[w]._socket.resume()}function Cr(s){const e=this[w];e._socket[w]!==void 0&&(e._socket.removeListener("data",Re),process.nextTick(Kt,e._socket),e.close(s[mr])),e.emit("error",s)}function wt(){this[w].emitClose()}function Or(s,e){this[w].emit("message",s,e)}function Nr(s){const e=this[w];e.pong(s,!e._isServer,zt),e.emit("ping",s)}function Rr(s){this[w].emit("pong",s)}function Kt(s){s.resume()}function Xt(){const s=this[w];this.removeListener("close",Xt),this.removeListener("data",Re),this.removeListener("end",Jt),s._readyState=p.CLOSING;let e;!this._readableState.endEmitted&&!s._closeFrameReceived&&!s._receiver._writableState.errorEmitted&&(e=s._socket.read())!==null&&s._receiver.write(e),s._receiver.end(),this[w]=void 0,clearTimeout(s._closeTimer),s._receiver._writableState.finished||s._receiver._writableState.errorEmitted?s.emitClose():(s._receiver.on("error",wt),s._receiver.on("finish",wt))}function Re(s){this[w]._receiver.write(s)||this.pause()}function Jt(){const s=this[w];s._readyState=p.CLOSING,s._receiver.end(),this.end()}function Qt(){const s=this[w];this.removeListener("error",Qt),this.on("error",zt),s&&(s._readyState=p.CLOSING,this.destroy())}const{Duplex:Lr}=y;function Tt(s){s.emit("close")}function Ar(){!this.destroyed&&this._writableState.finished&&this.destroy()}function Zt(s){this.removeListener("error",Zt),this.destroy(),this.listenerCount("error")===0&&this.emit("error",s)}function Br(s,e){let t=!0,r=!0;function n(){t&&s._socket.resume()}s.readyState===s.CONNECTING?s.once("open",function(){s._receiver.removeAllListeners("drain"),s._receiver.on("drain",n)}):(s._receiver.removeAllListeners("drain"),s._receiver.on("drain",n));const i=new Lr({...e,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return s.on("message",function(a,h){const c=!h&&i._readableState.objectMode?a.toString():a;i.push(c)||(t=!1,s._socket.pause())}),s.once("error",function(a){i.destroyed||(r=!1,i.destroy(a))}),s.once("close",function(){i.destroyed||i.push(null)}),i._destroy=function(o,a){if(s.readyState===s.CLOSED){a(o),process.nextTick(Tt,i);return}let h=!1;s.once("error",function(u){h=!0,a(u)}),s.once("close",function(){h||a(o),process.nextTick(Tt,i)}),r&&s.terminate()},i._final=function(o){if(s.readyState===s.CONNECTING){s.once("open",function(){i._final(o)});return}s._socket!==null&&(s._socket._writableState.finished?(o(),i._readableState.endEmitted&&i.destroy()):(s._socket.once("finish",function(){o()}),s.close()))},i._read=function(){s.readyState===s.OPEN&&!t&&(t=!0,s._receiver._writableState.needDrain||s._socket.resume())},i._write=function(o,a,h){if(s.readyState===s.CONNECTING){s.once("open",function(){i._write(o,a,h)});return}s.send(o,h)},i.on("end",Ar),i.on("error",Zt),i}var Pr=Br;const{tokenChars:Dr}=Oe;function Ir(s){const e=new Set;let t=-1,r=-1,n=0;for(n;n<s.length;n++){const o=s.charCodeAt(n);if(r===-1&&Dr[o]===1)t===-1&&(t=n);else if(n!==0&&(o===32||o===9))r===-1&&t!==-1&&(r=n);else if(o===44){if(t===-1)throw new SyntaxError(`Unexpected character at index ${n}`);r===-1&&(r=n);const a=s.slice(t,r);if(e.has(a))throw new SyntaxError(`The "${a}" subprotocol is duplicated`);e.add(a),t=r=-1}else throw new SyntaxError(`Unexpected character at index ${n}`)}if(t===-1||r!==-1)throw new SyntaxError("Unexpected end of input");const i=s.slice(t,n);if(e.has(i))throw new SyntaxError(`The "${i}" subprotocol is duplicated`);return e.add(i),e}var Ur={parse:Ir};const{createHash:Mr}=y,{GUID:Fr,kWebSocket:$r}=Y,qr=/^[+/0-9A-Za-z]{22}==$/,kt=0,Ct=1,es=2;class Vr extends y{constructor(e,t){if(super(),e={maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,...e},e.port==null&&!e.server&&!e.noServer||e.port!=null&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(e.port!=null?(this._server=y.createServer((r,n)=>{const i=y.STATUS_CODES[426];n.writeHead(426,{"Content-Length":i.length,"Content-Type":"text/plain"}),n.end(i)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server){const r=this.emit.bind(this,"connection");this._removeListeners=jr(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(n,i,o)=>{this.handleUpgrade(n,i,o,r)}})}e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=kt}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(this._state===es){e&&this.once("close",()=>{e(new Error("The server is not running"))}),process.nextTick(ce,this);return}if(e&&this.once("close",e),this._state!==Ct)if(this._state=Ct,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(ce,this):process.nextTick(ce,this);else{const t=this._server;this._removeListeners(),this._removeListeners=this._server=null,t.close(()=>{ce(this)})}}shouldHandle(e){if(this.options.path){const t=e.url.indexOf("?");if((t!==-1?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,r,n){t.on("error",We);const i=e.headers["sec-websocket-key"]!==void 0?e.headers["sec-websocket-key"]:!1,o=+e.headers["sec-websocket-version"];if(e.method!=="GET"||e.headers.upgrade.toLowerCase()!=="websocket"||!i||!qr.test(i)||o!==8&&o!==13||!this.shouldHandle(e))return Q(t,400);const a=e.headers["sec-websocket-protocol"];let h=new Set;if(a!==void 0)try{h=Ur.parse(a)}catch{return Q(t,400)}const c=e.headers["sec-websocket-extensions"],u={};if(this.options.perMessageDeflate&&c!==void 0){const l=new x(this.options.perMessageDeflate,!0,this.options.maxPayload);try{const d=Ve.parse(c);d[x.extensionName]&&(l.accept(d[x.extensionName]),u[x.extensionName]=l)}catch{return Q(t,400)}}if(this.options.verifyClient){const l={origin:e.headers[`${o===8?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(l,(d,g,v,b)=>{if(!d)return Q(t,g||401,v,b);this.completeUpgrade(u,i,h,e,t,r,n)});return}if(!this.options.verifyClient(l))return Q(t,401)}this.completeUpgrade(u,i,h,e,t,r,n)}completeUpgrade(e,t,r,n,i,o,a){if(!i.readable||!i.writable)return i.destroy();if(i[$r])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>kt)return Q(i,503);const c=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${Mr("sha1").update(t+Fr).digest("base64")}`],u=new I(null);if(r.size){const l=this.options.handleProtocols?this.options.handleProtocols(r,n):r.values().next().value;l&&(c.push(`Sec-WebSocket-Protocol: ${l}`),u._protocol=l)}if(e[x.extensionName]){const l=e[x.extensionName].params,d=Ve.format({[x.extensionName]:[l]});c.push(`Sec-WebSocket-Extensions: ${d}`),u._extensions=e}this.emit("headers",c,n),i.write(c.concat(`\r
`).join(`\r
`)),i.removeListener("error",We),u.setSocket(i,o,{maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(u),u.on("close",()=>{this.clients.delete(u),this._shouldEmitClose&&!this.clients.size&&process.nextTick(ce,this)})),a(u,n)}}var Wr=Vr;function jr(s,e){for(const t of Object.keys(e))s.on(t,e[t]);return function(){for(const r of Object.keys(e))s.removeListener(r,e[r])}}function ce(s){s._state=es,s.emit("close")}function We(){this.destroy()}function Q(s,e,t,r){s.writable&&(t=t||y.STATUS_CODES[e],r={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(t),...r},s.write(`HTTP/1.1 ${e} ${y.STATUS_CODES[e]}\r
`+Object.keys(r).map(n=>`${n}: ${r[n]}`).join(`\r
`)+`\r
\r
`+t)),s.removeListener("error",We),s.destroy()}I.createWebSocketStream=Pr;I.Server=Wr;I.Receiver=Ht;I.Sender=Gt;I.WebSocket=I;I.WebSocketServer=I.Server;var Hr=I;const he=Hr,Ot=!1,Gr="nodebuffer",zr=process.nextTick,Nt=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Ke extends Mt{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,r=Nt?{}:Bt(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=Ot&&!Nt?t?new he(e,t):new he(e):new he(e,t,r)}catch(n){return this.emit("error",n)}this.ws.binaryType=this.socket.binaryType||Gr,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=this.onClose.bind(this),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],n=t===e.length-1;Pt(r,this.supportsBinary,i=>{const o={};r.options&&(o.compress=r.options.compress),this.opts.perMessageDeflate&&(typeof i=="string"?Buffer.byteLength(i):i.length)<this.opts.perMessageDeflate.threshold&&(o.compress=!1);try{Ot||this.ws.send(i,o)}catch{}n&&zr(()=>{this.writable=!0,this.emit("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let r="";this.opts.port&&(t==="wss"&&Number(this.opts.port)!==443||t==="ws"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=qt()),this.supportsBinary||(e.b64=1);const n=ze.encode(e),i=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(i?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(n.length?"?"+n:"")}check(){return!!he&&!("__initialize"in he&&this.name===Ke.prototype.name)}}const Yr={websocket:Ke,polling:qs};class j extends ee{constructor(e,t={}){super(),e&&typeof e=="object"&&(t=e,e=null),e?(e=Fe(e),t.hostname=e.host,t.secure=e.protocol==="https"||e.protocol==="wss",t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=Fe(t.host).host),Ce(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+"/",typeof this.opts.query=="string"&&(this.opts.query=ze.decode(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&addEventListener("beforeunload",()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},!1),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close")},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Kr(this.opts.query);t.EIO=Ut,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new Yr[e](r)}open(){let e;if(this.opts.rememberUpgrade&&j.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch{this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",()=>{this.onClose("transport close")})}probe(e){let t=this.createTransport(e),r=!1;j.priorWebsocketSuccess=!1;const n=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",l=>{if(!r)if(l.type==="pong"&&l.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;j.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(u(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const d=new Error("probe error");d.transport=t.name,this.emitReserved("upgradeError",d)}}))};function i(){r||(r=!0,u(),t.close(),t=null)}const o=l=>{const d=new Error("probe error: "+l);d.transport=t.name,i(),this.emitReserved("upgradeError",d)};function a(){o("transport closed")}function h(){o("socket closed")}function c(l){t&&l.name!==t.name&&i()}const u=()=>{t.removeListener("open",n),t.removeListener("error",o),t.removeListener("close",a),this.off("close",h),this.off("upgrading",c)};t.once("open",n),t.once("error",o),t.once("close",a),this.once("close",h),this.once("upgrading",c),t.open()}onOpen(){if(this.readyState="open",j.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade&&this.transport.pause){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emitReserved("flush"))}write(e,t,r){return this.sendPacket("message",e,t,r),this}send(e,t,r){return this.sendPacket("message",e,t,r),this}sendPacket(e,t,r,n){if(typeof t=="function"&&(n=t,t=void 0),typeof r=="function"&&(n=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const i={type:e,data:t,options:r};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),n&&this.once("flush",n),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}onError(e){j.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let r=0;const n=e.length;for(;r<n;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}j.protocol=Ut;function Kr(s){const e={};for(let t in s)s.hasOwnProperty(t)&&(e[t]=s[t]);return e}const Xr=typeof ArrayBuffer=="function",Jr=s=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(s):s.buffer instanceof ArrayBuffer,ts=Object.prototype.toString,Qr=typeof Blob=="function"||typeof Blob<"u"&&ts.call(Blob)==="[object BlobConstructor]",Zr=typeof File=="function"||typeof File<"u"&&ts.call(File)==="[object FileConstructor]";function Xe(s){return Xr&&(s instanceof ArrayBuffer||Jr(s))||Qr&&s instanceof Blob||Zr&&s instanceof File}function xe(s,e){if(!s||typeof s!="object")return!1;if(Array.isArray(s)){for(let t=0,r=s.length;t<r;t++)if(xe(s[t]))return!0;return!1}if(Xe(s))return!0;if(s.toJSON&&typeof s.toJSON=="function"&&arguments.length===1)return xe(s.toJSON(),!0);for(const t in s)if(Object.prototype.hasOwnProperty.call(s,t)&&xe(s[t]))return!0;return!1}function en(s){const e=[],t=s.data,r=s;return r.data=je(t,e),r.attachments=e.length,{packet:r,buffers:e}}function je(s,e){if(!s)return s;if(Xe(s)){const t={_placeholder:!0,num:e.length};return e.push(s),t}else if(Array.isArray(s)){const t=new Array(s.length);for(let r=0;r<s.length;r++)t[r]=je(s[r],e);return t}else if(typeof s=="object"&&!(s instanceof Date)){const t={};for(const r in s)s.hasOwnProperty(r)&&(t[r]=je(s[r],e));return t}return s}function tn(s,e){return s.data=He(s.data,e),s.attachments=void 0,s}function He(s,e){if(!s)return s;if(s&&s._placeholder)return e[s.num];if(Array.isArray(s))for(let t=0;t<s.length;t++)s[t]=He(s[t],e);else if(typeof s=="object")for(const t in s)s.hasOwnProperty(t)&&(s[t]=He(s[t],e));return s}const ss=5;var _;(function(s){s[s.CONNECT=0]="CONNECT",s[s.DISCONNECT=1]="DISCONNECT",s[s.EVENT=2]="EVENT",s[s.ACK=3]="ACK",s[s.CONNECT_ERROR=4]="CONNECT_ERROR",s[s.BINARY_EVENT=5]="BINARY_EVENT",s[s.BINARY_ACK=6]="BINARY_ACK"})(_||(_={}));class sn{encode(e){return(e.type===_.EVENT||e.type===_.ACK)&&xe(e)?(e.type=e.type===_.EVENT?_.BINARY_EVENT:_.BINARY_ACK,this.encodeAsBinary(e)):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===_.BINARY_EVENT||e.type===_.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data)),t}encodeAsBinary(e){const t=en(e),r=this.encodeAsString(t.packet),n=t.buffers;return n.unshift(r),n}}class Je extends ee{constructor(){super()}add(e){let t;if(typeof e=="string")t=this.decodeString(e),t.type===_.BINARY_EVENT||t.type===_.BINARY_ACK?(this.reconstructor=new nn(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t);else if(Xe(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const r={type:Number(e.charAt(0))};if(_[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===_.BINARY_EVENT||r.type===_.BINARY_ACK){const i=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const o=e.substring(i,t);if(o!=Number(o)||e.charAt(t)!=="-")throw new Error("Illegal attachments");r.attachments=Number(o)}if(e.charAt(t+1)==="/"){const i=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););r.nsp=e.substring(i,t)}else r.nsp="/";const n=e.charAt(t+1);if(n!==""&&Number(n)==n){const i=t+1;for(;++t;){const o=e.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===e.length)break}r.id=Number(e.substring(i,t+1))}if(e.charAt(++t)){const i=rn(e.substr(t));if(Je.isPayloadValid(r.type,i))r.data=i;else throw new Error("invalid payload")}return r}static isPayloadValid(e,t){switch(e){case _.CONNECT:return typeof t=="object";case _.DISCONNECT:return t===void 0;case _.CONNECT_ERROR:return typeof t=="string"||typeof t=="object";case _.EVENT:case _.BINARY_EVENT:return Array.isArray(t)&&t.length>0;case _.ACK:case _.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}function rn(s){try{return JSON.parse(s)}catch{return!1}}class nn{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=tn(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}var on=Object.freeze({__proto__:null,protocol:ss,get PacketType(){return _},Encoder:sn,Decoder:Je});function A(s,e,t){return s.on(e,t),function(){s.off(e,t)}}const an=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Qe extends ee{constructor(e,t,r){super(),this.connected=!1,this.disconnected=!0,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this.io._autoConnect&&this.open()}subEvents(){if(this.subs)return;const e=this.io;this.subs=[A(e,"open",this.onopen.bind(this)),A(e,"packet",this.onpacket.bind(this)),A(e,"error",this.onerror.bind(this)),A(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(an.hasOwnProperty(e))throw new Error('"'+e+'" is a reserved event name');t.unshift(e);const r={type:_.EVENT,data:t};if(r.options={},r.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const o=this.ids++,a=t.pop();this._registerAckCallback(o,a),r.id=o}const n=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!n||!this.connected)||(this.connected?this.packet(r):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(e,t){const r=this.flags.timeout;if(r===void 0){this.acks[e]=t;return}const n=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let i=0;i<this.sendBuffer.length;i++)this.sendBuffer[i].id===e&&this.sendBuffer.splice(i,1);t.call(this,new Error("operation has timed out"))},r);this.acks[e]=(...i)=>{this.io.clearTimeoutFn(n),t.apply(this,[null,...i])}}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this.packet({type:_.CONNECT,data:e})}):this.packet({type:_.CONNECT,data:this.auth})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e){this.connected=!1,this.disconnected=!0,delete this.id,this.emitReserved("disconnect",e)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case _.CONNECT:if(e.data&&e.data.sid){const n=e.data.sid;this.onconnect(n)}else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case _.EVENT:this.onevent(e);break;case _.BINARY_EVENT:this.onevent(e);break;case _.ACK:this.onack(e);break;case _.BINARY_ACK:this.onack(e);break;case _.DISCONNECT:this.ondisconnect();break;case _.CONNECT_ERROR:this.destroy();const r=new Error(e.data.message);r.data=e.data.data,this.emitReserved("connect_error",r);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,e)}super.emit.apply(this,e)}ack(e){const t=this;let r=!1;return function(...n){r||(r=!0,t.packet({type:_.ACK,id:e,data:n}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e){this.id=e,this.connected=!0,this.disconnected=!1,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>this.packet(e)),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:_.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}}var cn=te;function te(s){s=s||{},this.ms=s.min||100,this.max=s.max||1e4,this.factor=s.factor||2,this.jitter=s.jitter>0&&s.jitter<=1?s.jitter:0,this.attempts=0}te.prototype.duration=function(){var s=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*s);s=Math.floor(e*10)&1?s+t:s-t}return Math.min(s,this.max)|0};te.prototype.reset=function(){this.attempts=0};te.prototype.setMin=function(s){this.ms=s};te.prototype.setMax=function(s){this.max=s};te.prototype.setJitter=function(s){this.jitter=s};class ke extends ee{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,Ce(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((r=t.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new cn({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const n=t.parser||on;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new j(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const n=A(t,"open",function(){r.onopen(),e&&e()}),i=A(t,"error",o=>{r.cleanup(),r._readyState="closed",this.emitReserved("error",o),e?e(o):r.maybeReconnectOnOpen()});if(this._timeout!==!1){const o=this._timeout;o===0&&n();const a=this.setTimeoutFn(()=>{n(),t.close(),t.emit("error",new Error("timeout"))},o);this.opts.autoUnref&&a.unref(),this.subs.push(function(){clearTimeout(a)})}return this.subs.push(n),this.subs.push(i),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(A(e,"ping",this.onping.bind(this)),A(e,"data",this.ondata.bind(this)),A(e,"error",this.onerror.bind(this)),A(e,"close",this.onclose.bind(this)),A(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){this.decoder.add(e)}ondecoded(e){this.emitReserved("packet",e)}onerror(e){this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r||(r=new Qe(this,e,t),this.nsps[e]=r),r}_destroy(e){const t=Object.keys(this.nsps);for(const r of t)if(this.nsps[r].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(n=>{n?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",n)):e.onreconnect()}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(function(){clearTimeout(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const le={};function z(s,e){typeof s=="object"&&(e=s,s=void 0),e=e||{};const t=xs(s,e.path||"/socket.io"),r=t.source,n=t.id,i=t.path,o=le[n]&&i in le[n].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let h;return a?h=new ke(r,e):(le[n]||(le[n]=new ke(r,e)),h=le[n]),t.query&&!e.query&&(e.query=t.queryKey),h.socket(t.path,e)}Object.assign(z,{Manager:ke,Socket:Qe,io:z,connect:z});var hn=Object.freeze({__proto__:null,Manager:ke,Socket:Qe,io:z,connect:z,default:z,protocol:ss});const ln=require("simple-signal-client");var Ze=Rt({name:"vue-webrtc",components:{},data(){return{signalClient:null,videoList:[],canvas:null,socket:null}},props:{roomId:{type:String,default:"public-room-v2"},socketURL:{type:String,default:"https://weston-vue-webrtc-lobby.azurewebsites.net"},cameraHeight:{type:[Number,String],default:160},autoplay:{type:Boolean,default:!0},screenshotFormat:{type:String,default:"image/jpeg"},enableAudio:{type:Boolean,default:!0},enableVideo:{type:Boolean,default:!0},enableLogs:{type:Boolean,default:!1},peerOptions:{type:Object,default(){return{}}},ioOptions:{type:Object,default(){return{rejectUnauthorized:!1,transports:["polling","websocket"]}}},deviceId:{type:String,default:null}},watch:{},mounted(){},methods:{async join(){var s=this;this.log("join"),this.socket=z(this.socketURL,this.ioOptions),this.signalClient=new ln(this.socket);let e={video:s.enableVideo,audio:s.enableAudio};s.deviceId&&s.enableVideo&&(e.video={deviceId:{exact:s.deviceId}});const t=await navigator.mediaDevices.getUserMedia(e);this.log("opened",t),this.joinedRoom(t,!0),this.signalClient.once("discover",r=>{s.log("discovered",r);async function n(i){if(i!=s.socket.id)try{s.log("Connecting to peer");const{peer:o}=await s.signalClient.connect(i,s.roomId,s.peerOptions);s.videoList.forEach(a=>{a.isLocal&&s.onPeer(o,a.stream)})}catch{s.log("Error connecting to peer")}}r.peers.forEach(i=>n(i)),s.$emit("opened-room",s.roomId)}),this.signalClient.on("request",async r=>{s.log("requested",r);const{peer:n}=await r.accept({},s.peerOptions);s.log("accepted",n),s.videoList.forEach(i=>{i.isLocal&&s.onPeer(n,i.stream)})}),this.signalClient.discover(s.roomId)},onPeer(s,e){var t=this;t.log("onPeer"),s.addStream(e),s.on("stream",r=>{t.joinedRoom(r,!1),s.on("close",()=>{var n=[];t.videoList.forEach(function(i){i.id!==r.id&&n.push(i)}),t.videoList=n,t.$emit("left-room",r.id)}),s.on("error",n=>{t.log("peer error ",n)})})},joinedRoom(s,e){var t=this;if(t.videoList.find(n=>n.id===s.id)===void 0){let n={id:s.id,muted:e,stream:s,isLocal:e};t.videoList.push(n)}setTimeout(function(){for(var n=0,i=t.$refs.videos.length;n<i;n++)if(t.$refs.videos[n].id===s.id){t.$refs.videos[n].srcObject=s;break}},500),t.$emit("joined-room",s.id)},leave(){this.videoList.forEach(s=>s.stream.getTracks().forEach(e=>e.stop())),this.videoList=[],this.signalClient.peers().forEach(s=>s.removeAllListeners()),this.signalClient.destroy(),this.signalClient=null,this.socket.destroy(),this.socket=null},capture(){return this.getCanvas().toDataURL(this.screenshotFormat)},getCanvas(){let s=this.$refs.videos[0];if(s!==null&&!this.ctx){let r=document.createElement("canvas");r.height=s.clientHeight,r.width=s.clientWidth,this.canvas=r,this.ctx=r.getContext("2d")}const{ctx:e,canvas:t}=this;return e.drawImage(s,0,0,t.width,t.height),t},async shareScreen(){var s=this;if(navigator.mediaDevices==null){s.log("Error: https is required to load cameras");return}try{var e=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!1});this.joinedRoom(e,!0),s.$emit("share-started",e.id),s.signalClient.peers().forEach(t=>s.onPeer(t,e))}catch(t){s.log("Media error: "+JSON.stringify(t))}},log(s,e){this.enableLogs&&(console.log(s),e!=null&&console.log(e))}}});const fn={class:"video-list"},un=["video"],dn=["height","muted","id"];function pn(s,e,t,r,n,i){return de(),pe("div",fn,[(de(!0),pe(fs,null,us(s.videoList,o=>(de(),pe("div",{video:o,key:o.id,class:"video-item"},[E("video",{controls:"",autoplay:"",playsinline:"",ref_for:!0,ref:"videos",height:s.cameraHeight,muted:o.muted,id:o.id},null,8,dn)],8,un))),128))])}function rs(s,e){e===void 0&&(e={});var t=e.insertAt;if(!(!s||typeof document>"u")){var r=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",t==="top"&&r.firstChild?r.insertBefore(n,r.firstChild):r.appendChild(n),n.styleSheet?n.styleSheet.cssText=s:n.appendChild(document.createTextNode(s))}}var mn=`
.video-list[data-v-41044b41] {\r
        background: whitesmoke;\r
        height: auto;\r
        display: flex;\r
        flex-direction: row;\r
        justify-content: center;\r
        flex-wrap: wrap;
}
.video-list div[data-v-41044b41] {\r
            padding: 0px;
}
.video-item[data-v-41044b41] {\r
        background: #c5c4c4;\r
        display: inline-block;
}\r
`;rs(mn);Ze.render=pn;Ze.__scopeId="data-v-41044b41";var ns=Rt({name:"VueWebrtcSample",data(){return{counter:5,initCounter:5,message:{action:null,amount:null}}},computed:{changedBy(){const{message:s}=this;return s.action?`${s.action} ${s.amount||""}`.trim():"initialized"}},methods:{increment(s){const e=typeof s!="number"?1:s;this.counter+=e,this.message.action="incremented by",this.message.amount=e},decrement(s){const e=typeof s!="number"?1:s;this.counter-=e,this.message.action="decremented by",this.message.amount=e},reset(){this.counter=this.initCounter,this.message.action="reset",this.message.amount=null}}});const _n={class:"vue-webrtc-sample"},yn=Lt(".");function gn(s,e,t,r,n,i){return de(),pe("div",_n,[E("p",null,[Lt("The counter was "+rt(s.changedBy)+" to ",1),E("b",null,rt(s.counter),1),yn]),E("button",{onClick:e[0]||(e[0]=function(){return s.increment&&s.increment(...arguments)})}," Click +1 "),E("button",{onClick:e[1]||(e[1]=function(){return s.decrement&&s.decrement(...arguments)})}," Click -1 "),E("button",{onClick:e[2]||(e[2]=o=>s.increment(5))}," Click +5 "),E("button",{onClick:e[3]||(e[3]=o=>s.decrement(5))}," Click -5 "),E("button",{onClick:e[4]||(e[4]=function(){return s.reset&&s.reset(...arguments)})}," Reset ")])}var vn=`
.vue-webrtc-sample[data-v-3020e3b4] {\r
    display: block;\r
    width: 400px;\r
    margin: 25px auto;\r
    border: 1px solid #ccc;\r
    background: #eaeaea;\r
    text-align: center;\r
    padding: 25px;
}
.vue-webrtc-sample p[data-v-3020e3b4] {\r
    margin: 0 0 1em;
}\r
`;rs(vn);ns.render=gn;ns.__scopeId="data-v-3020e3b4";window.io=hn;const En={name:"demo-component",components:{"vue-webrtc":Ze},data(){return{img:null,roomId:"public-room-v3"}},mounted:function(){},computed:{},watch:{},methods:{onCapture(){this.img=this.$refs.webrtc.capture()},onJoin(){this.$refs.webrtc.join()},onLeave(){this.$refs.webrtc.leave()},onShareScreen(){this.img=this.$refs.webrtc.shareScreen()},onError(s,e){console.log("On Error Event",s,e)},logEvent(s){console.log("Event : ",s)}}},bn={class:"container"},Sn={class:"row"},xn={class:"col-md-12 my-3"},wn=E("h2",null,"Room",-1),Tn={class:"row"},kn={class:"col-md-12"},Cn={class:""},On={class:"row"},Nn={class:"col-md-12 my-3"},Rn={class:"row"},Ln={class:"col-md-12"},An=E("h2",null,"Captured Image",-1),Bn={class:"figure"},Pn=["src"];function Dn(s,e,t,r,n,i){const o=ys("vue-webrtc");return de(),pe("div",bn,[E("div",Sn,[E("div",xn,[wn,ps(E("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>n.roomId=a)},null,512),[[ms,n.roomId]])])]),E("div",Tn,[E("div",kn,[E("div",Cn,[_s(o,{ref:"webrtc",width:"100%",roomId:n.roomId,enableLogs:!0,onJoinedRoom:i.logEvent,onLeftRoom:i.logEvent,onOpenedRoom:i.logEvent,onShareStarted:i.logEvent,onShareStopped:i.logEvent,onError:i.onError},null,8,["roomId","onJoinedRoom","onLeftRoom","onOpenedRoom","onShareStarted","onShareStopped","onError"])]),E("div",On,[E("div",Nn,[E("button",{type:"button",class:"btn btn-primary",onClick:e[1]||(e[1]=(...a)=>i.onJoin&&i.onJoin(...a))},"Join"),E("button",{type:"button",class:"btn btn-primary",onClick:e[2]||(e[2]=(...a)=>i.onLeave&&i.onLeave(...a))},"Leave"),E("button",{type:"button",class:"btn btn-primary",onClick:e[3]||(e[3]=(...a)=>i.onCapture&&i.onCapture(...a))},"Capture Photo"),E("button",{type:"button",class:"btn btn-primary",onClick:e[4]||(e[4]=(...a)=>i.onShareScreen&&i.onShareScreen(...a))},"Share Screen")])])])]),E("div",Rn,[E("div",Ln,[An,E("figure",Bn,[E("img",{src:n.img,class:"img-responsive"},null,8,Pn)])])])])}const Un=ds(En,[["render",Dn]]);export{Un as default};
