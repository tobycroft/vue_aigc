import{_ as r,a1 as c,o as n,c as l}from"./index-bBKnZR8T.js";import{V as h}from"./VContainer-ZvM6akza.js";const d={name:"App",components:{},props:{aigcUrl:{default:"https://aigc.aerofsx.com:444",type:String},sdkUrl:{default:"",type:String},model:{default:()=>["Potion-Maker/Pio","school-2017-costume-yellow"],type:Array},homePage:{default:"https://ai.aerofsx.com:444",type:String},width:{default:0,type:Number},height:{default:0,type:Number},size:{default:255,type:Number},uid:{default:0},token:{default:""}},async created(){},async data(){return{message:"",AudioStream:new Audio,viewer:null,ViewerJS:null}},async beforeMount(){},watch(){},async mounted(){this.ViewerJS=(await c(()=>import("https://vrm.ai.aerofsx.com:444/features/vrmViewer/viewer.js"),[])).Viewer,this.viewer=null,this.viewer=new this.ViewerJS,setInterval(this.say,500);const e=document.createElement("canvas");e.height=this.height?this.height:300,e.width=this.width?this.width:300,document.getElementById("canvas").appendChild(e),this.viewer.setup(e),await this.viewer.loadVrm("https://vrm.ai.aerofsx.com:444/avatars/2368129704508832941.vrm"),this.viewer.model.emoteController.playEmotion("neutral")},methods:{async say(){const e=localStorage.getItem("doAction");if(e){localStorage.removeItem("doAction");try{const t=JSON.parse(e);switch(t.type){case"say":this.speak(t.text);break;case"chat":this.chat(t.text);break;case"idle":this.idle();break;default:console.log(t)}}catch(t){console.log("doAction-error",t)}}},async speak(e){await this.iflyVoice(e),this.viewer.model.emoteController.playEmotion("neutral")},async iflyVoice(e=""){let t=new FormData;t.set("message",e);const a=await this.Post(`${this.aigcUrl}/v1/iflytek/tts/audio`,t);try{const o=await a.blob();let i=await fetch(URL.createObjectURL(o)).then(s=>s.arrayBuffer());await this.viewer.model.speak(i,{expression:"happy"})}catch(o){console.log("iflyVoice-error",o)}},async chat(e){let t=new FormData;t.set("message",e),t.set("chat_id","111");let a=await(await this.Post(`${this.aigcUrl}/v1/fastgpt/api/text`,t)).json();return a.code!==0&&console.log("chat-error",a.echo),this.speak(a.echo),a.echo},async dance(){this.viewer.model.loadAnimation("https://vrm.ai.aerofsx.com:444/OpenCharacters/animations/silly_dancing.fbx")},async idle(){this.viewer.model.loadAnimation("https://vrm.ai.aerofsx.com:444/idle_loop.vrma")},async Post(e,t){return await fetch(e,{method:"POST",headers:{uid:this.uid,token:this.token},body:t,mode:"cors",credentials:"include"})}}};function m(e,t,a,o,i,s){return n(),l(h,{id:"canvas"})}const f=r(d,[["render",m],["__scopeId","data-v-1446bf69"]]);export{f as v};
